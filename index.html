<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Serviços LL - Linha Viva Leve</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
  :root {
    --energisa-blue: #0097CE;
    --energisa-blue-dark: #0079a6;
    --energisa-orange: #F36F21;
    --bg-soft: #eef6fa;
    --bg-white: #ffffff;
    --text-dark: #333;
  }

  * { box-sizing: border-box; }
  body {
    font-family: "Segoe UI", Roboto, sans-serif;
    background: var(--bg-soft);
    margin: 0;
  }

  /* HEADER */
  .header {
    background: var(--energisa-blue);
    color: white;
    padding: 16px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  .header h2 { margin: 0; font-weight: 700; letter-spacing: 1px; }

  .logout-btn {
    background: var(--energisa-orange);
    border: none;
    padding: 10px 14px;
    border-radius: 8px;
    color: white;
    cursor: pointer;
    font-weight: 600;
  }
  .logout-btn:hover { background: #d65c18; }

  /* CARD */
  .card {
    max-width: 900px;
    margin: 30px auto;
    padding: 28px;
    background: var(--bg-white);
    border-radius: 14px;
    box-shadow: 0 6px 26px rgba(0,0,0,0.10);
    border-top: 6px solid var(--energisa-orange);
  }

  h1 {
    text-align: center;
    color: var(--energisa-blue-dark);
    margin-bottom: 20px;
    font-size: 26px;
    font-weight: 800;
  }

  form { display: grid; gap: 15px; }
  label { font-weight: 600; margin-bottom: 4px; }

  input, select, textarea {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #cfd8dc;
    font-size: 15px;
    background: #fdfdfd;
  }
  input:focus, select:focus, textarea:focus {
    border-color: var(--energisa-blue);
    box-shadow: 0 0 0 2px rgba(0,151,206,0.25);
  }

  /* GRID */
  .row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 18px;
  }
  @media(max-width: 720px) { .row { grid-template-columns: 1fr; } }

  /* BUTTONS */
  button {
    background: var(--energisa-blue);
    color: white;
    border: none;
    padding: 14px;
    font-size: 16px;
    font-weight: 700;
    border-radius: 10px;
    cursor: pointer;
  }
  button:hover { background: var(--energisa-blue-dark); }

  .small { padding: 10px; font-size: 13px; background: var(--energisa-orange); }
  .small:hover { background: #d85e1c; }

  .dashboard-btn {
    display: block;
    background: var(--energisa-blue-dark);
    color: white;
    text-align: center;
    padding: 13px;
    margin-top: 14px;
    border-radius: 10px;
    font-weight: 700;
    text-decoration: none;
  }
  .dashboard-btn:hover { background: #005f85; }

  .muted {
    color: #666;
    font-size: 13px;
    text-align: center;
    margin-top: 10px;
  }

  .inline { display:flex; gap:10px; align-items:center; }
  .file-preview { margin-top:8px; max-height:220px; border-radius:8px; }
  .radio-group { display:flex; gap:12px; align-items:center; }
  .required-star { color: #c62828; margin-left:6px; }
</style>
</head>
<body>

<div class="card">
  <h1>FORMULÁRIO - SERVIÇOS LL</h1>

  <form id="llForm" autocomplete="off">

    <!-- 1 Nome da equipe -->
    <div>
      <label>1. Qual a nomenclatura da equipe? <span class="required-star">*</span></label>
      <input id="equipe" required>
    </div>

    <!-- 2 Base operacional / 3 Componente -->
    <div class="row">
      <div>
        <label>2. Qual a sua base operacional? <span class="required-star">*</span></label>
        <select id="base" required>
          <option value="">Selecione...</option>
          <option>João Pessoa</option>
          <option>Campina Grande</option>
          <option>Patos</option>
          <option>Outros</option>
        </select>
      </div>

      <div>
        <label>3. Qual o componente? <span class="required-star">*</span></label>
        <input id="componente" required>
      </div>
    </div>

    <!-- 4 Serviço LL / 5 Medidor de referência -->
    <div class="row">
      <div>
        <label>4. Qual o serviço para equipe LL (Linha Viva Leve)? <span class="required-star">*</span></label>
        <select id="servicoll" required>
          <option value="">Selecione...</option>
          <option>Inspeção</option>
          <option>Instalação</option>
          <option>Manutenção</option>
          <option>Retirada</option>
        </select>
      </div>

      <div>
        <label>5. Qual o medidor de referência? <span class="required-star">*</span></label>
        <input id="medidor" required>
      </div>
    </div>

    <!-- 6 Tipo do condutor / 7 Cabeamento alma de aço -->
    <div class="row">
      <div>
        <label>6. Qual o Tipo do Condutor? <span class="required-star">*</span></label>
        <input id="condutor" required>
      </div>

      <div>
        <label>7. O cabeamento tem alma de Aço? <span class="required-star">*</span></label>
        <div class="radio-group">
          <label><input type="radio" name="almaaço" value="Sim" required> Sim</label>
          <label><input type="radio" name="almaaço" value="Não"> Não</label>
          <label><input type="radio" name="almaaço" value="Não Verificado"> Não Verificado</label>
        </div>
      </div>
    </div>

    <!-- 8 Acesso ao caminhão / 9 Endereço -->
    <div class="row">
      <div>
        <label>8. Tem acesso ao caminhão? <span class="required-star">*</span></label>
        <div class="radio-group">
          <label><input type="radio" name="acessocaminhao" value="Sim" required> Sim</label>
          <label><input type="radio" name="acessocaminhao" value="Não"> Não</label>
        </div>
      </div>

      <div>
        <label>9. Qual o endereço? <span class="required-star">*</span></label>
        <input id="endereco" required>
      </div>
    </div>

    <!-- 10 Fotos do componente (1 arquivo) + GPS -->
    <div>
      <label>10. Adicionar Fotos do componente: <span class="required-star">*</span></label>
      <div class="inline">
        <input id="file" type="file" accept=".jpg,.jpeg,.png,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.mp4,.mov,.avi,.mp3,.wav" />
        <button type="button" id="btnGeo" class="small">Obter Localização</button>
      </div>
      <div id="fileInfo" class="muted">Limite: 1 arquivo • Máx 10MB • Tipos: Imagem, Vídeo, PDF, Office, Áudio</div>
      <img id="preview" class="file-preview" style="display:none;" alt="Pré-visualização" />
      <input id="gps" readonly placeholder="Coordenadas aparecerão aqui (lat, lng)" style="margin-top:8px;" />
    </div>

    <!-- 11 Observação -->
    <div>
      <label>11. Alguma observação?</label>
      <textarea rows="3" id="observacao"></textarea>
    </div>

    <button id="btnSubmit">Enviar Registro LL</button>

    <p class="muted">Desenvolvido por Pedro Fillype – Grupo Energisa</p>
  </form>
</div>

<script>
/* ------------------------ CONFIGURAÇÃO: Substitua por seu endpoint ------------------------ */
// Coloque aqui a URL para onde o formulário deve ser enviado (substitua pelo seu serviço C).
const SUBMIT_URL = 'https://example.com/submit_ll'; // <-- troque para o endpoint real
/* ----------------------------------------------------------------------------------------- */

function logout(){
  localStorage.clear();
  // ajuste a URL de login se necessário
  window.location.href = "https://coec-epb.github.io/login/";
}

/* INICIALIZAÇÃO (preencher matrícula/nome se quiser replicar login do outro form) */
document.addEventListener('DOMContentLoaded', () => {
  const matriculaSalva = localStorage.getItem('matricula');
  if (matriculaSalva) {
    // se desejar prefazer campos, faça aqui. Mantive sem preenchimento automático por segurança.
  }
});

/* GEOLOCALIZAÇÃO */
document.getElementById('btnGeo').addEventListener('click', () => {
  const btnGeo = document.getElementById('btnGeo');
  const gps = document.getElementById('gps');

  if (!navigator.geolocation) {
    alert('Seu navegador não suporta geolocalização.');
    return;
  }

  btnGeo.innerText = 'Capturando...';
  btnGeo.disabled = true;

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const lat = pos.coords.latitude.toFixed(6);
      const lng = pos.coords.longitude.toFixed(6);
      gps.value = `${lat}, ${lng}`;
      btnGeo.innerText = 'Localização OK!';
      btnGeo.style.background = '#43a047';
      btnGeo.disabled = false;
    },
    (err) => {
      alert('Não foi possível capturar a localização.');
      btnGeo.innerText = 'Obter Localização';
      btnGeo.disabled = false;
    },
    { enableHighAccuracy: true, timeout: 10000 }
  );
});

/* ARQUIVO: pré-visualização e validação */
const fileInput = document.getElementById('file');
const preview = document.getElementById('preview');
fileInput.addEventListener('change', () => {
  const f = fileInput.files[0];
  preview.style.display = 'none';
  if (!f) return;

  const maxBytes = 10 * 1024 * 1024; // 10MB
  if (f.size > maxBytes) {
    alert('Arquivo excede 10MB. Escolha um arquivo menor.');
    fileInput.value = '';
    return;
  }

  // se for imagem, mostrar preview
  if (f.type.startsWith('image/')) {
    const url = URL.createObjectURL(f);
    preview.src = url;
    preview.style.display = 'block';
  } else {
    // esconder preview para outros tipos
    preview.style.display = 'none';
  }
});

/* ENVIO DO FORMULÁRIO */
document.getElementById('llForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const btn = document.getElementById('btnSubmit');
  btn.disabled = true;
  btn.innerText = 'Enviando...';

  // coletar valores
  const get = id => document.getElementById(id).value.trim();

  // radio values
  const getRadio = name => {
    const r = document.querySelector(`input[name="${name}"]:checked`);
    return r ? r.value : '';
  };

  const payload = {
    equipe: get('equipe'),
    base: get('base'),
    componente: get('componente'),
    servicoll: get('servicoll'),
    medidor: get('medidor'),
    condutor: get('condutor'),
    almaaço: getRadio('almaaço'),
    acessocaminhao: getRadio('acessocaminhao'),
    endereco: get('endereco'),
    gps: get('gps'),
    observacao: get('observacao')
  };

  try {
    const fd = new FormData();
    for (const [k, v] of Object.entries(payload)) fd.append(k, v);

    // anexa arquivo, se existir
    if (fileInput.files && fileInput.files[0]) {
      fd.append('arquivo', fileInput.files[0]);
    }

    // Enviar para o endpoint configurado
    const resp = await fetch(SUBMIT_URL, {
      method: 'POST',
      body: fd,
      // não setar Content-Type: browser cuidará do boundary
    });

    if (!resp.ok) {
      // tenta obter mensagem de erro do servidor
      let text = await resp.text().catch(() => 'Resposta de erro do servidor');
      throw new Error(text || 'Erro no servidor');
    }

    alert('Registro LL enviado com sucesso!');
    document.getElementById('llForm').reset();
    preview.style.display = 'none';
    document.getElementById('btnGeo').innerText = 'Obter Localização';
    document.getElementById('btnGeo').style.background = '';
  }
  catch (err) {
    console.error(err);
    alert('Erro ao enviar: ' + (err.message || err));
  }

  btn.disabled = false;
  btn.innerText = 'Enviar Registro LL';
});
</script>

</body>
</html>
