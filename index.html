<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Serviços LL - Linha Viva Leve</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
  :root {
    --energisa-blue: #0097CE;
    --energisa-blue-dark: #0079a6;
    --energisa-orange: #F36F21;
    --bg-soft: #eef6fa;
    --bg-white: #ffffff;
    --text-dark: #333;
  }

  body {
    font-family: "Segoe UI", Roboto, sans-serif;
    background: var(--bg-soft);
    margin: 0;
  }

  .card {
    max-width: 900px;
    margin: 30px auto;
    padding: 28px;
    background: var(--bg-white);
    border-radius: 14px;
    box-shadow: 0 6px 26px rgba(0,0,0,0.10);
    border-top: 6px solid var(--energisa-orange);
  }

  h1 {
    text-align: center;
    color: var(--energisa-blue-dark);
    margin-bottom: 20px;
    font-size: 26px;
    font-weight: 800;
  }

  form { display: grid; gap: 15px; }
  label { font-weight: 600; margin-bottom: 4px; }

  input, select, textarea {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #cfd8dc;
    font-size: 15px;
  }

  .row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 18px;
  }
  @media(max-width: 720px) { .row { grid-template-columns: 1fr; } }

  button {
    background: var(--energisa-blue);
    color: white;
    border: none;
    padding: 14px;
    font-size: 16px;
    font-weight: 700;
    border-radius: 10px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div class="card">
  <h1>FORMULÁRIO - SERVIÇOS LL</h1>

  <form id="llForm" autocomplete="off">

    <!-- CAMPOS -->
    <div><label>1. Equipe *</label><input id="equipe" required></div>

    <div class="row">
      <div>
        <label>2. Base *</label>
        <select id="base" required>
          <option value="">Selecione...</option>
          <option>João Pessoa</option>
          <option>Campina Grande</option>
          <option>Patos</option>
          <option>Outros</option>
        </select>
      </div>

      <div>
        <label>3. Componente *</label>
        <input id="componente" required>
      </div>
    </div>

    <div class="row">
      <div>
        <label>4. Serviço LL *</label>
        <select id="servicoll" required>
          <option value="">Selecione...</option>
          <option>Inspeção</option>
          <option>Instalação</option>
          <option>Manutenção</option>
          <option>Retirada</option>
        </select>
      </div>

      <div>
        <label>5. Medidor *</label>
        <input id="medidor" required>
      </div>
    </div>

    <div class="row">
      <div>
        <label>6. Condutor *</label>
        <input id="condutor" required>
      </div>

      <div>
        <label>7. Alma de Aço *</label>
        <select id="almaaço" required>
          <option>Sim</option>
          <option>Não</option>
          <option>Não Verificado</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>8. Acesso caminhão *</label>
        <select id="acessocaminhao" required>
          <option>Sim</option>
          <option>Não</option>
        </select>
      </div>

      <div>
        <label>9. Endereço *</label>
        <input id="endereco" required>
      </div>
    </div>

    <div>
      <label>10. Arquivo + Localização *</label>
      <input id="file" type="file" accept="*" required>
      <button type="button" id="btnGeo">Obter Geolocalização</button>
      <input id="gps" readonly placeholder="Coordenadas aparecerão aqui" />
      <img id="preview" style="max-height:200px; margin-top:10px; display:none;" />
    </div>

    <div>
      <label>11. Observação</label>
      <textarea id="observacao" rows="3"></textarea>
    </div>

    <button id="btnSubmit">Enviar Registro LL</button>

  </form>
</div>

<script>
const SUBMIT_URL = "https://withered-hat-347d.pedro-fillype.workers.dev/submit";

/* GEOLOCATION */
document.getElementById('btnGeo').onclick = () => {
  const gps = document.getElementById('gps');
  gps.value = "Capturando localização...";

  navigator.geolocation.getCurrentPosition(
    pos => gps.value = pos.coords.latitude + ", " + pos.coords.longitude,
    err => gps.value = "Erro ao obter localização"
  );
};

/* FILE PREVIEW */
document.getElementById('file').onchange = e => {
  const file = e.target.files[0];
  const prev = document.getElementById('preview');
  if (file && file.type.startsWith("image/")) {
    prev.src = URL.createObjectURL(file);
    prev.style.display = "block";
  } else {
    prev.style.display = "none";
  }
};

/* SEND FORM */
document.getElementById('llForm').onsubmit = async e => {
  e.preventDefault();

  const fd = new FormData();
  fd.append("equipe", equipe.value);
  fd.append("base", base.value);
  fd.append("componente", componente.value);
  fd.append("servicoll", servicoll.value);
  fd.append("medidor", medidor.value);
  fd.append("condutor", condutor.value);
  fd.append("almaaço", almaaço.value);
  fd.append("acessocaminhao", acessocaminhao.value);
  fd.append("endereco", endereco.value);
  fd.append("gps", gps.value);
  fd.append("observacao", observacao.value);
  fd.append("arquivo", file.files[0]);

  const resp = await fetch(SUBMIT_URL, { method: "POST", body: fd });

  if (resp.ok) {
    alert("Registro LL enviado com sucesso!");
    llForm.reset();
    preview.style.display = "none";
  } else {
    alert("Erro ao enviar");
  }
};
</script>

</body>
</html>
